<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stranger Lights — Viewer</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Arial;background:#0b0b0b;color:#eee;padding:18px}
  .wrap{max-width:980px;margin:0 auto}
  h1{text-align:center}
  .grid{display:grid;grid-template-columns:repeat(10,1fr);gap:10px;justify-items:center;margin-top:18px}
  .cell{width:64px;height:64px;border-radius:8px;background:#222;display:flex;align-items:center;justify-content:center;transition:all .12s}
  .cell.on{background:#ff3b3b;transform:scale(1.07);box-shadow:0 12px 32px rgba(255,59,59,.14)}
  .letter{font-weight:700;color:#111}
  .status{display:flex;gap:12px;justify-content:center;margin-top:12px;color:#aaa}
  .small{font-size:13px;color:#bbb}
</style>
</head>
<body>
<div class="wrap">
  <h1>Stranger Lights — Viewer</h1>

  <div class="status">
    <div class="small" id="modeText">Mode: —</div>
    <div class="small">Speed: <span id="speedText">—</span> ms</div>
    <div class="small">Word: <span id="wordText">—</span></div>
    <div class="small">Updated: <span id="tsText">—</span></div>
  </div>

  <div id="board" class="grid"></div>
</div>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/9.32.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.32.0/firebase-database-compat.js"></script>

<script>
// --- SAME CONFIG AS CONTROLLER ---
const firebaseConfig = {
  apiKey: "AIzaSyC5DEtnD9UThmAblQ1iF5YXQypXtfVCp_s",
  authDomain: "stranger-things-c37aa.firebaseapp.com",
  databaseURL: "https://stranger-things-c37aa-default-rtdb.firebaseio.com",
  projectId: "stranger-things-c37aa",
  storageBucket: "stranger-things-c37aa.appspot.com",
  messagingSenderId: "841392728122",
  appId: "1:841392728122:web:64dd307f50769d03eb6d03",
  measurementId: "G-278D2DZNSB"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const stateRef = db.ref("/state");

// Build A–Z grid
const board = document.getElementById("board");
const letters = [];
for (let i=0;i<26;i++){
  const cell = document.createElement("div");
  cell.className = "cell";
  cell.innerHTML = `<div class='letter'>${String.fromCharCode(65+i)}</div>`;
  board.appendChild(cell);
  letters.push(cell);
}

function setOn(i, on){
  if (letters[i]) letters[i].classList.toggle("on", on);
}

stateRef.on("value", snap=>{
  const s = snap.val();
  if (!s) return;

  modeText.textContent = `Mode: ${s.mode}`;
  speedText.textContent = s.speed;
  wordText.textContent = s.word || "—";
  tsText.textContent = new Date(s.timestamp).toLocaleTimeString();

  // Mask mode
  if (s.mask !== undefined){
    const mask = Number(s.mask);
    for (let i=0;i<26;i++) setOn(i, (mask & (1<<i)) !== 0);
    return;
  }

  // Index mode
  if (s.currentIndex !== undefined){
    for (let i=0;i<26;i++) setOn(i, false);
    if (s.currentIndex >= 0) setOn(s.currentIndex, true);
  }
});
</script>
</body>
</html>
